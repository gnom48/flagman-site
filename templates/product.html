<!doctype html>
<html lang="ru" data-static="{{ url_for('static', filename='images/') }}">
<head>
  <meta charset="utf-8">
  <title>{{ product.title }} — ФЛАГМАН</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  {# ==== CANONICAL + ROBOTS ==== #}
  <link rel="canonical" href="{{ url_for('product_page', pid=product.id, _external=True) }}">

<meta name="robots" content="index, follow, max-image-preview:large">
<meta name="theme-color" content="#0b0f14">

{# ==== DESCRIPTION (из краткого описания, если есть) ==== #}
<meta name="description" content="{{ (product.meta_description or product.short_description or product.title) | striptags | truncate(180, True) }}">

{# ==== Open Graph ==== #}
<meta property="og:type" content="product">
<meta property="og:site_name" content="ФЛАГМАН">
<meta property="og:title" content="{{ product.title }} — ФЛАГМАН">
<meta property="og:description" content="{{ (product.og_description or product.meta_description or product.short_description or product.title) | striptags | truncate(200, True) }}">
<meta property="og:url" content="{{ url_for('product_page', pid=product.id, _external=True) }}">
<meta property="og:image" content="{% if product.image_url %}{{ product.image_url }}{% elif product.image %}{{ url_for('static', filename=product.image, _external=True) }}{% else %}{{ url_for('static', filename='images/og-product-fallback.jpg', _external=True) }}{% endif %}">
<meta property="og:locale" content="ru_RU">

{# ==== Twitter Card ==== #}
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ product.title }} — ФЛАГМАН">
<meta name="twitter:description" content="{{ (product.og_description or product.meta_description or product.short_description or product.title) | striptags | truncate(200, True) }}">
<meta name="twitter:image" content="{% if product.image_url %}{{ product.image_url }}{% elif product.image %}{{ url_for('static', filename=product.image, _external=True) }}{% else %}{{ url_for('static', filename='images/og-product-fallback.jpg', _external=True) }}{% endif %}">

{# ==== PRELOAD (опционально ускоряет первую картинку товара) ==== #}
<link rel="preload" as="image"
      href="{% if product.image_url %}{{ product.image_url }}{% elif product.image %}{{ url_for('static', filename=product.image, _external=True) }}{% else %}{{ url_for('static', filename='images/og-product-fallback.jpg', _external=True) }}{% endif %}">


  <!-- Базовые стили проекта -->
  <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/catalog_main.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/product_cars.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/footer.css') }}">
   <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/mobile_navbar.css') }}">

<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"Product",
  "name": {{ product.title | tojson }},
  "description": {{ (product.desc or product.title) | striptags | tojson }},
  "url": "{{ url_for('product_page', pid=product.id, _external=True) }}",
  "image": ["{{ url_for('static', filename='images/' ~ product.img, _external=True) }}"],
  "sku": {{ (product.id|string) | tojson }},
  "brand": {"@type":"Brand","name":"ФЛАГМАН"},
  "category": {{ product.category | default('') | tojson }},
  "keywords": {{ (product.tags or []) | join(', ') | tojson }}
  {% if product.specs %},
  "additionalProperty": [
    {% for k, v in product.specs.items() -%}
    {"@type":"PropertyValue","name":{{ k|tojson }},"value":{{ v|tojson }}}{% if not loop.last %},{% endif %}
    {%- endfor %}
  ]{% endif %}
}
</script>

<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"BreadcrumbList",
  "itemListElement":[
    {"@type":"ListItem","position":1,"name":"Главная","item":"{{ url_for('index', _external=True) }}"},
    {"@type":"ListItem","position":2,"name":"Каталог","item":"{{ url_for('catalog', _external=True) }}"},
    {"@type":"ListItem","position":3,"name":{{ product.title|tojson }},"item":"{{ url_for('product_page', pid=product.id, _external=True) }}"}
  ]
}
</script>

  <!-- Yandex.Metrika counter -->
<script type="text/javascript">
(function(m,e,t,r,i,k,a){
    m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();
    for (var j = 0; j < document.scripts.length; j++) {
        if (document.scripts[j].src === r) { return; }
    }
    k=e.createElement(t),a=e.getElementsByTagName(t)[0],
    k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
})(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105914224', 'ym');

ym(105914224, 'init', {
    webvisor:true,
    clickmap:true,
    accurateTrackBounce:true,
    trackLinks:true,
    ecommerce:"dataLayer"
});
</script>
<!-- /Yandex.Metrika counter -->


</head>
<body>
  
  <header class="navbar-floating" id="nav" role="navigation" aria-label="Главное меню">
  <a class="nav__brand" href="/" aria-label="На главную">Flagman</a>

  <button class="nav__burger" id="navBurger"
          aria-label="Открыть меню" aria-controls="navPanel" aria-expanded="false">
    <span class="burger__bar"></span>
    <span class="burger__bar"></span>
    <span class="burger__bar"></span>
  </button>

  <nav class="nav__links">
    <a href="/catalog">Каталог</a>
    <a href="/about">О компании</a>
    <a href="/contact">Контакты</a>
    <a href="#consult" class="nav__cta">Заявка</a>
  </nav>

  <!-- Мобильная панель -->
  <div class="nav-panel" id="navPanel" hidden>
    <div class="nav-panel__inner">
      <a href="/catalog" class="nav-panel__link">Каталог</a>
      <a href="/about" class="nav-panel__link">О компании</a>
      <a href="/contact" class="nav-panel__link">Контакты</a>
      <a href="#consult" class="nav-panel__link nav-panel__cta">Оставить заявку</a>
    </div>
  </div>
  </header>
  <!-- Карточка товара -->
  <main class="p-wrap">
    <div class="p-container">
        <nav class="breadcrumbs" aria-label="Хлебные крошки">
          <ol class="breadcrumbs__list">
            {% for title, href in breadcrumbs %}
              <li class="breadcrumbs__item">
                {% if href %}
                  <a class="breadcrumbs__link" href="{{ href }}">{{ title }}</a>
                {% else %}
                  <span class="breadcrumbs__current" aria-current="page">{{ title }}</span>
                {% endif %}
              </li>
            {% endfor %}
          </ol>
       </nav>

      <section class="p-card">
        <div class="p-media">
          {% if product.img %}
            <img src="{{ url_for('static', filename='images/' ~ product.img) }}" alt="{{ product.title }}">
          {% endif %}
        </div>
       <div class="p-body">
          <h1 class="p-title">{{ product.title }}</h1>

          {% set specs = product.get('specs') %}
          {% if specs %}
            <ul class="specs">
              {# выводим все пары ключ–значение из specs #}
              {% for k, v in specs.items() if v %}
                <li>
                  <span class="k">{{ k|replace('_',' ')|replace('-', ' ')|title }}</span>
                  <span>{{ v }}</span>
                </li>
              {% endfor %}
            </ul>
          {% endif %}

          <button class="p-cta" id="btnPrice"
                  data-title="{{ (product.title or '')|replace('\n',' ') }}">
            Уточнить цену
          </button>
        </div>

      </section>

      <!-- Аккордеоны -->
      <section class="acc">
        <div class="acc-item">
          <button class="acc-btn" type="button" aria-expanded="true">
            <span class="acc-icon">+</span> Описание
          </button>
          <div class="acc-panel">
            <p>{{ product.desc or 'Описание уточняйте у менеджера.' }}</p>
          </div>
        </div>
        <div class="acc-item">
          <button class="acc-btn" type="button" aria-expanded="false">
            <span class="acc-icon">+</span> Доставка
          </button>
          <div class="acc-panel">
            <p>Доставляем по городу и области. Самовывоз — по согласованию со складом. Условия и стоимость — в зависимости от объёма и адреса.</p>
          </div>
        </div>
    </section>

    </div>
  </main>

  <!-- Похожие товары -->
  {% if related %}
  <section class="rel">
    <div class="h2">Похожие товары</div>
    <div class="rel-grid">
      {% for p in related %}
      <article class="product">
        <div class="product__media">
          {% if p.img %}<img src="{{ url_for('static', filename='images/' ~ p.img) }}" alt="{{ p.title }}">{% endif %}
        </div>
        <div class="product__body">
          <h4 class="product__title">{{ p.title }}</h4>
        </div>
        <a class="product__overlay" href="/product/{{ p.id }}"></a>
        <a class="product__cta" href="/product/{{ p.id }}" aria-label="Открыть">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M7 17L17 7M9 7h8v8"/>
          </svg>
        </a>
      </article>
      {% endfor %}
    </div>
  </section>
  {% endif %}

  <footer class="site-footer">
    <div class="footer__glass">
      <div class="footer__container">
        <div class="footer__top">
          <a class="footer__logo" href="/">flagman02</a>

          <nav class="footer__nav" aria-label="Нижнее меню">
            <ul class="footer__menu">
              <li><a href="/">Главная</a></li>
              <li><a href="/catalog">Каталог</a></li>
              <li><a href="/about">О нас</a></li>
              <li><a href="/contacts">Контакты</a></li>
            </ul>
          </nav>

          <div class="footer__social">
            <a class="footer__soc" href="#" aria-label="Мы в VK">
              <!-- VK -->
              <svg viewBox="0 0 24 24" width="28" height="28" aria-hidden="true">
                <path fill="currentColor" d="M21.6 7.7c.1-.4 0-.7-.6-.7h-2.1c-.5 0-.7.3-.9.6 0 0-1.1 2.6-2.6 4.3-.5.5-.7.6-1 .6-.1 0-.3-.1-.3-.6V7.7c0-.5-.1-.7-.6-.7H9.6c-.3 0-.5.2-.5.4 0 .5.8.6.9 1.9v2.9c0 .6-.1.7-.3.7-.7 0-2.3-2.5-3.2-5.3-.1-.4-.3-.6-.8-.6H3.6c-.5 0-.6.3-.6.6 0 .6.7 3.7 3.7 7.8 2 2.7 4.8 4.1 7.3 4.1 1.5 0 1.7-.3 1.7-.7v-1.7c0-.5.1-.6.4-.6.2 0 .6.1 1.5.9 1 .9 1.1 1.2 1.7 1.2h2.1c.5 0 .8-.3.7-.8-.2-.6-1-1.5-2.1-2.6-.6-.6-1.5-1.2-1.7-1.5-.2-.2-.2-.4 0-.7 0 0 2.9-4 3.2-5.4Z"/>
              </svg>
            </a>
            <a class="footer__soc" href="#" aria-label="Мы в Telegram">
              <!-- Telegram -->
              <svg viewBox="0 0 24 24" width="28" height="28" aria-hidden="true">
                <path fill="currentColor" d="M21.5 3.5 2.9 10.6c-1 .4-.9 1.7.1 1.9l4.7 1.3 1.9 5.9c.3.9 1.4 1.1 2 .4l2.8-3 4.7 3.5c.8.6 2 .1 2.2-.9l3-15.1c.2-1-.7-1.9-1.8-1.6Z"/>
              </svg>
            </a>
          </div>
        </div>

        <div class="footer__bottom">
          <span class="footer__copy">Все права защищены</span>
          <a class="footer__policy" href="/privacy">Политика конфиденциальности</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Модальное окно -->
  <div class="modal" id="priceModal" aria-hidden="true">
    <div class="modal__card" role="dialog" aria-modal="true" aria-labelledby="mTitle">
      <button class="close" id="mClose" aria-label="Закрыть">✕</button>
      <h3 id="mTitle">Уточнить цену</h3>
      <p>Можем позвонить и подсказать актуальную стоимость и наличие. Или наберите нас:</p>
      <div class="phone">+7(962) 525-16-45</div>

      <form class="f" id="priceForm">
        <div>
          <label for="mName">Ваше имя</label>
          <input id="mName" name="name" type="text" placeholder="Иван" required>
        </div>
        <div>
          <label for="mPhone">Телефон</label>
          <input id="mPhone" name="phone" type="tel" placeholder="+7 (___) ___-__-__" required>
        </div>
        <button type="submit">Заказать звонок</button>
        <small style="opacity:.7">Нажимая кнопку, вы соглашаетесь с условиями конфиденциальности.</small>
      </form>
    </div>
  </div>
</body>

 <script src="{{ url_for('static', filename='assets/js/product_card.js') }}" defer></script>

 <script src="{{ url_for('static', filename='assets/js/js-navbar.js') }}" defer></script>
 <script src="{{ url_for('static', filename='assets/js/mobile_navbar.js') }}" defer></script>


</html>
